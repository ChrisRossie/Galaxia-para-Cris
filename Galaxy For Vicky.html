<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Galaxia para Vicky</title>
  <meta name="description" content="Galaxia interactiva de frases de cariÃ±o ðŸ’˜">
  <meta property="og:title" content="Galaxia para Vicky">
  <meta property="og:description" content="Una galaxia interactiva con palabras de cariÃ±o ðŸ’–">
  <meta property="og:image" content="og-cover.png">
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    html,body{margin:0;height:100%;background:#000;overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial}
    
    /* Welcome Screen */
    #welcome-screen{position:fixed;inset:0;background:linear-gradient(135deg,#0a0014,#1a0030);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:1000;color:white;padding:20px;text-align:center;}
    .welcome-content{max-width:600px;background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);padding:40px;border-radius:20px;border:1px solid rgba(255,255,255,0.2);}
    .welcome-title{font-size:2.5em;margin-bottom:20px;background:linear-gradient(45deg,#ff6b6b,#ffd93d,#6bcf7f,#4d96ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    .welcome-message{font-size:1.2em;line-height:1.6;margin-bottom:30px;color:#e6e6ff;}
    #enter-btn{padding:15px 40px;font-size:1.3em;background:linear-gradient(45deg,#ff6b6b,#4d96ff);border:none;border-radius:50px;color:white;cursor:pointer;transition:transform 0.3s;font-weight:bold;}
    #enter-btn:hover{transform:scale(1.1);}
    
    /* Warp Effect */
    #warp-effect{position:fixed;inset:0;background:#000;z-index:999;display:none;}
    .warp-line{position:absolute;height:2px;background:linear-gradient(90deg,transparent,#4d96ff,transparent);width:100%;}
    
    /* Galaxy */
    #galaxy-canvas{position:fixed;inset:0;width:100%;height:100%;display:block;touch-action:none;display:none;}
    .pill{position:fixed;top:10px;left:50%;transform:translateX(-50%);padding:6px 12px;border-radius:999px;
          background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);color:#fff;font:12px -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial;display:none;}
    .error{position:fixed;inset:auto 10px 70px 10px;background:#260015;color:#ffd9f7;border:1px solid #ff8ae5;border-radius:10px;padding:10px;font:12px system-ui;display:none;}
  </style>
  <!-- Three.js legacy non-module build + OrbitControls (r128, super estable) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
<!-- Welcome Screen -->
<div id="welcome-screen">
  <div class="welcome-content">
    <h1 class="welcome-title">âœ¨ Hola, mi linda princesa âœ¨</h1>
    <p class="welcome-message">
      Esta es tu galaxia, ven acÃ¡ cada que quieras sentirte amada.<br>
      Recuerda que te amo mil millones.<br><br>
      - Chris
    </p>
    <button id="enter-btn">ðŸš€ Viajar a tu galaxia</button>
  </div>
</div>

<!-- Warp Effect -->
<div id="warp-effect"></div>

<!-- Galaxy -->
<canvas id="galaxy-canvas"></canvas>
<div class="pill">Te Amo Muchote Mi Princesa Hermosa VickyðŸ’›</div>
<div id="err" class="error"></div>

<canvas id="fx" style="position:fixed;inset:0;pointer-events:none;display:none;"></canvas>

<audio id="background-music" loop>
  <source src="cancion.mp3" type="audio/mpeg">
  Tu navegador no soporta el elemento de audio.
</audio>
<script>
(function(){
// ====== WELCOME SCREEN & WARP EFFECT ======
const welcomeScreen = document.getElementById('welcome-screen');
const warpEffect = document.getElementById('warp-effect');
const galaxyCanvas = document.getElementById('galaxy-canvas');
const fxCanvas = document.getElementById('fx');
const pill = document.querySelector('.pill');
const backgroundMusic = document.getElementById('background-music');
const enterBtn = document.getElementById('enter-btn');

// Variable para controlar si el audio ya se intentÃ³ reproducir
let audioStarted = false;

function createWarpEffect() {
  warpEffect.innerHTML = '';
  const lines = 50;
  
  for (let i = 0; i < lines; i++) {
    const line = document.createElement('div');
    line.className = 'warp-line';
    line.style.top = `${(i / lines) * 100}%`;
    line.style.opacity = '0';
    warpEffect.appendChild(line);
  }
  
  return warpEffect.querySelectorAll('.warp-line');
}

function startWarpTransition() {
  welcomeScreen.style.display = 'none';
  warpEffect.style.display = 'block';
  
  const lines = warpEffect.querySelectorAll('.warp-line');
  let completed = 0;
  
  lines.forEach((line, index) => {
    setTimeout(() => {
      // Animate line
      line.style.opacity = '1';
      line.animate([
        { transform: 'scaleX(0.1)', opacity: 0 },
        { transform: 'scaleX(1)', opacity: 0.8 },
        { transform: 'scaleX(0.1)', opacity: 0 }
      ], {
        duration: 800,
        easing: 'cubic-bezier(0.4, 0, 0.2, 1)'
      });
      
      // Check if all animations completed
      setTimeout(() => {
        completed++;
        if (completed === lines.length) {
          warpEffect.style.display = 'none';
          showGalaxy();
        }
      }, 800);
    }, index * 40);
  });
}

function showGalaxy() {
  galaxyCanvas.style.display = 'block';
  fxCanvas.style.display = 'block';
  pill.style.display = 'block';
  
  // Start background music with user interaction context
  if (!audioStarted) {
    backgroundMusic.play().then(() => {
      console.log('Audio started successfully');
      audioStarted = true;
    }).catch(e => {
      console.log('Audio playback failed:', e);
      // Mostrar mensaje amigable para el usuario
      const err = document.getElementById('err');
      err.textContent = 'Para escuchar la mÃºsica, haz clic en cualquier parte de la pantalla o actualiza la pÃ¡gina y permite el audio.';
      err.style.display = 'block';
      
      // Intentar reproducir con un clic del usuario
      const playOnClick = () => {
        backgroundMusic.play().then(() => {
          console.log('Audio started after user interaction');
          audioStarted = true;
          err.style.display = 'none';
          document.removeEventListener('click', playOnClick);
        }).catch(e => console.log('Still failed:', e));
      };
      
      document.addEventListener('click', playOnClick);
    });
  }
  
  // Initialize galaxy
  initGalaxy();
}

enterBtn.addEventListener('click', startWarpTransition);
createWarpEffect();

// ====== GALAXY INITIALIZATION ======
const err = document.getElementById('err');
function showError(msg){ err.textContent = msg; err.style.display='block'; }

// ====== WEBGL CHECK ======
try { 
  const test = document.createElement('canvas').getContext('webgl') || document.createElement('canvas').getContext('experimental-webgl');
  if(!test) throw new Error('Tu navegador no tiene WebGL activo');
} catch(e) { showError('WebGL parece desactivado. Prueba con Chrome/Edge/Firefox, o habilita aceleraciÃ³n por hardware.'); return; }

// ====== THREE.JS GALAXY ======
function initGalaxy() {
try {
// Setup
const canvas = document.getElementById('galaxy-canvas');
const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:false });
renderer.setPixelRatio(Math.min(2, window.devicePixelRatio||1));
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.outputEncoding = THREE.sRGBEncoding;

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true; controls.dampingFactor = 0.06;
controls.minDistance = 10; controls.maxDistance = 220;
controls.target.set(0,0,0);

// Camera default
function setCam(){
  const w = window.innerWidth, h = window.innerHeight;
  const isMobile = w < 768 || w < h;
  camera.fov = isMobile ? 90 : 75;
  camera.position.set(0, isMobile? 26 : 22, isMobile? 110 : 75);
  camera.updateProjectionMatrix(); controls.update();
} setCam();

// ---------- Prettier starfield texture (soft glow + variety) ----------
function makePrettyStarTexture(size=1024, count=2000) {
  const c = document.createElement('canvas'); c.width = c.height = size;
  const g = c.getContext('2d');
  // subtle nebula backdrop (very dark purple radial)
  const r = size/2;
  const bg = g.createRadialGradient(r,r, r*0.2, r,r, r);
  bg.addColorStop(0,'#050010');
  bg.addColorStop(1,'#000000');
  g.fillStyle = bg; g.fillRect(0,0,size,size);

  for (let i=0;i<count;i++) {
    const x = Math.random()*size, y = Math.random()*size;
    const base = Math.random()*0.7 + 0.3; // brightness
    const glow = g.createRadialGradient(x,y,0, x,y, Math.random()*2.2+1.6);
    // color tilt towards lilac/blue
    const huePick = Math.random();
    let colInner = 'rgba(255,255,255,'+(0.65*base)+')';
    let colOuter = 'rgba(180,190,255,'+(0.12*base)+')';
    if (huePick < 0.25) { colOuter = 'rgba(255,180,240,'+(0.12*base)+')'; }
    glow.addColorStop(0, colInner);
    glow.addColorStop(1, colOuter);
    g.fillStyle = glow; g.beginPath(); g.arc(x,y, Math.random()*1.2+0.6, 0, Math.PI*2); g.fill();
  }
  return new THREE.CanvasTexture(c);
}

const bgGeo = new THREE.SphereGeometry(600, 64, 64);
const starTex = makePrettyStarTexture(1024, 2600);
starTex.wrapS = starTex.wrapT = THREE.RepeatWrapping;
const bg = new THREE.Mesh(bgGeo, new THREE.MeshBasicMaterial({ map: starTex, side: THREE.BackSide, transparent:false, opacity:0.85 }));
scene.add(bg);

// Galaxy
const galaxy = new THREE.Group(); scene.add(galaxy);
const phrases = ["Princesa âœ¨", "Hermosa ðŸ’›", "Mi BebÃ©", "Mi Cielito ðŸŒŒ", "Hermosota âœ¨", "Mi Infinita â™¾ï¸", "Mi Todo", "Me Encantas ðŸ¥°", "Vicky ðŸ’«", "Te AmoðŸ’›", "Mi CanciÃ³n Favorita ðŸŽ¶", "Ãšnica ðŸ˜Š", "Mi Reina ðŸ‘‘", "Mi Amor", "Mi Mundo", "Mi Luz ðŸŒ ", "Mi NiÃ±a", "Mi TesoroðŸ’›", "Mi Paz", "Mi Eterna", "Mi SueÃ±o", "Mi Pensamiento Favorito", "Mi BombÃ³n", "Mi Diosa", "Te Amo Infinitamente â™¾ï¸", "Si lees esto me debes un beso mi amor", "Te amo mil millones"];
const phraseCount = Math.max(phrases.length * 6, 180);
const arms = 5, radius = 82, maxH = 22;

function makeTextTexture(text, size=48){
  const c=document.createElement('canvas'); c.width=1024; c.height=128;
  const g=c.getContext('2d'); g.clearRect(0,0,c.width,c.height);
  g.font='800 '+size+'px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial';
  g.textAlign='center'; g.textBaseline='middle';
  g.shadowColor='rgba(210,140,255,0.95)'; g.shadowBlur=24;
  g.fillStyle='rgba(255,240,255,0.98)'; g.fillText(text,c.width/2,c.height/2);
  return new THREE.CanvasTexture(c);
}

for(let i=0;i<phraseCount;i++){ const text = phrases[i%phrases.length];
  const tex=makeTextTexture(text,48);
  const spr=new THREE.Sprite(new THREE.SpriteMaterial({ map:tex, transparent:true, depthWrite:false }));
  spr.isPhrase=true;
  const perArm=phraseCount/arms; const ang=(i%perArm)*(Math.PI*2/perArm);
  const armAng=Math.floor(i/perArm)*(Math.PI*2/arms);
  const dist=Math.pow(i/phraseCount,0.72)*radius;
  const thickness=Math.pow(1-(dist/radius),2);
  const x=Math.cos(ang+armAng)*dist, z=Math.sin(ang+armAng)*dist, y=(Math.random()-0.5)*maxH*thickness*.9;
  spr.position.set(x,y,z); spr.scale.set(20,2.6,1); galaxy.add(spr);
}

// Galaxy stars (keep subtle)
const starCount=8000, geom=new THREE.BufferGeometry(), pos=new Float32Array(starCount*3);
for(let i=0;i<starCount;i++){ const ang=Math.random()*Math.PI*2, dist=Math.random()*radius*1.15;
  const y=(Math.random()-0.5)*36*Math.pow(1-Math.min(dist,radius)/radius,1.5);
  pos[i*3]=Math.cos(ang)*dist; pos[i*3+1]=y; pos[i*3+2]=Math.sin(ang)*dist; }
geom.setAttribute('position', new THREE.BufferAttribute(pos,3));
galaxy.add(new THREE.Points(geom, new THREE.PointsMaterial({ color:0xffffff, size:0.28, transparent:true, opacity:0.65, blending:THREE.AdditiveBlending })));

// Black hole (3D core + ring + extended brighter halo)
const coreR=12;
const coreTexCanvas=document.createElement('canvas'); coreTexCanvas.width=coreTexCanvas.height=256;
const cg=coreTexCanvas.getContext('2d'); const grd=cg.createRadialGradient(128,128,10,128,128,128);
grd.addColorStop(0,'#140018'); grd.addColorStop(0.6,'#090012'); grd.addColorStop(1,'#000'); cg.fillStyle=grd; cg.arc(128,128,128,0,Math.PI*2); cg.fill();
const core=new THREE.Mesh(new THREE.SphereGeometry(coreR,64,64), new THREE.MeshBasicMaterial({ map:new THREE.CanvasTexture(coreTexCanvas) }));
core.renderOrder=1; scene.add(core);

const photonRing=new THREE.Mesh(new THREE.RingGeometry(coreR*1.05, coreR*1.18, 128), new THREE.MeshBasicMaterial({ color:0xEAAEFF, transparent:true, opacity:0.95, side:THREE.DoubleSide }));
photonRing.rotation.x=-Math.PI/2; photonRing.renderOrder=0.5; scene.add(photonRing);

function makeHaloTexture(size=1024, inner=0.45){
  const c=document.createElement('canvas'); c.width=c.height=size; const g=c.getContext('2d'); const r=size/2;
  const grd=g.createRadialGradient(r,r,r*inner, r,r,r);
  // brighter, clearer colors
  grd.addColorStop(0.0,'rgba(255,200,240,0.45)');
  grd.addColorStop(0.35,'rgba(220,180,255,0.35)');
  grd.addColorStop(0.7,'rgba(160,200,255,0.28)');
  grd.addColorStop(1,'rgba(0,0,0,0)');
  g.fillStyle=grd; g.fillRect(0,0,size,size); const tex=new THREE.CanvasTexture(c); tex.needsUpdate=true; return tex;
}
const haloPlane=new THREE.Mesh(new THREE.PlaneGeometry(320,320), new THREE.MeshBasicMaterial({ map:makeHaloTexture(1024,0.45), transparent:true, depthWrite:false, blending:THREE.AdditiveBlending, opacity:0.9 }));
haloPlane.rotation.x=-Math.PI/2; haloPlane.renderOrder=0.2; scene.add(haloPlane);

// Subtle twinkle (animate bg texture offset)
let tw = 0;
function animate(){
  requestAnimationFrame(animate);
  const t = performance.now()*0.001;
  tw = (tw + 0.0003) % 1;
  starTex.offset.set(tw, 0); // tiny drift
  galaxy.rotation.y = t * 0.05;
  core.rotation.y = t * 0.12;
  photonRing.rotation.z = t * 0.18;
  haloPlane.rotation.z = t * 0.02;
  controls.update();
  renderer.render(scene, camera);
} animate();

// ====== HEARTS OVERLAY (double tap/click) ======
const fx = document.getElementById('fx');
const ctx2 = fx.getContext('2d');
function resizeFx(){
  fx.width = Math.floor(innerWidth * Math.min(2, window.devicePixelRatio||1));
  fx.height = Math.floor(innerHeight * Math.min(2, window.devicePixelRatio||1));
  fx.style.width = innerWidth + 'px';
  fx.style.height = innerHeight + 'px';
}
addEventListener('resize', resizeFx); resizeFx();
const DPR = Math.min(2, window.devicePixelRatio || 1);
const hearts = [];
function spawnHearts(x,y,n=20){
  x *= DPR; y *= DPR;
  for(let i=0;i<n;i++){ const a=Math.random()*Math.PI*2;
    hearts.push({x,y,vx:Math.cos(a)*(0.6+Math.random()*0.8),vy:-(0.8+Math.random()*1.2),life:1,size:10+Math.random()*16});
  }
}
function drawHeart(x,y,size){
  const s=size; ctx2.save(); ctx2.translate(x,y);
  ctx2.beginPath(); ctx2.moveTo(0,-0.25*s);
  ctx2.bezierCurveTo(.5*s,-.9*s,1.4*s,-.1*s,0,.9*s);
  ctx2.bezierCurveTo(-1.4*s,-.1*s,-.5*s,-.9*s,0,-.25*s);
  const g=ctx2.createRadialGradient(0,0,0,0,0,s);
  g.addColorStop(0,'rgba(255,190,220,.95)'); g.addColorStop(1,'rgba(255,90,160,0)');
  ctx2.fillStyle=g; ctx2.fill(); ctx2.restore();
}
let lastTap=0;
addEventListener('click', (e)=>{ const now=performance.now(); if(now-lastTap<320) spawnHearts(e.clientX,e.clientY,20); lastTap=now; }, {passive:true});
addEventListener('touchend', (e)=>{ const now=performance.now(); const t=e.changedTouches&&e.changedTouches[0]; if(now-lastTap<320&&t) spawnHearts(t.clientX,t.clientY,20); lastTap=now; }, {passive:true});

function loopFx(){
  ctx2.clearRect(0,0,fx.width,fx.height);
  for(let i=hearts.length-1;i>=0;i--){ const h=hearts[i]; h.x+=h.vx; h.y+=h.vy; h.vy-=0.02; h.life-=0.015;
    ctx2.globalAlpha=Math.max(0,h.life); drawHeart(h.x,h.y,h.size); ctx2.globalAlpha=1; if(h.life<=0) hearts.splice(i,1);
  }
  requestAnimationFrame(loopFx);
} loopFx();

} catch(e) { showError('Error cargando la galaxia: '+e.message); console.error(e); }
}

// Handle window resize
window.addEventListener('resize', function() {
  if (typeof setCam === 'function') setCam();
  if (typeof resizeFx === 'function') resizeFx();
});
})();
</script>
</body>
</html>